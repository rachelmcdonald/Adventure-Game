<!DOCTYPE html>
<html>
<head>
    <title>The Mosslit Path</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="fireflies">
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
    </div>

    <div class="game-container">
        
        <div class="stats">
            ðŸŒ± Courage: {{ session.courage }} |
            ðŸª™ Gold: {{ session.gold }}
            {% if session.blessing %}| âœ¨ Blessed{% endif %}
        </div>

        {% if scene %}
            <p class="scene-text">{{ scene }}</p>
        {% else %}
            <p class="scene-text">Your adventure awaits! Press begin to start.</p>
        {% endif %}

        {% if session.scene in ['left', 'fairy_help', 'fairy_ignore'] %}
            <div class="character-area">
                <div class="fairy-wrapper
                    {% if session.scene == 'fairy_help' %} blessed {% endif %}
                    {% if session.scene == 'fairy_ignore' %} offended {% endif %}
                ">
                    <img src="{{ url_for('static', filename='images/fairy.png') }}" class="fairy-sprite {% if session.scene == 'left' %}bob{% else %}sway{% endif %}" alt="Forest Fairy"/>

                    <div class="sparkles"></div>
            </div>

                {% if session.scene == 'fairy_help' %}
                    <div class="dialogue-box">
                        <span class="typewriter">
                            âœ¨ "Hello travelerâ€¦ I am Luma of the Moss. May this light guide you."
                        </span>
                    </div>   
                {% elif session.scene == 'fairy_ignore' %}
                    <div class="dialogue-box angry">
                        <span class="typewriter">
                            "...The forest remembers those who walk without kindness."
                        </span>
                    </div>   
                {% endif %}       
            </div>
        {% endif %}

        {% if session.scene in ['right', 'wizard_talk', 'wizard_pass'] %}
            <div class="character-area">
                <div class="wizard-wrapper
                    {% if session.scene == 'wizard_talk' %} blessed {% endif %}
                    {% if session.scene == 'wizard_pass' %} offended {% endif %}
                ">
                    <img src="{{ url_for('static', filename='images/wizard.png') }}" class="wizard-sprite">

                    <div class="wizard-sparkles"></div>
                </div>
                    {% if session.scene == 'wizard_talk' %}

                        <div class="dialogue-box">
                            <span class="typewriter">
                                ðŸŒ¿ "The moss remembers kindness. Walk with courage, traveler."
                            </span>
                        </div>

                    {% elif session.scene == 'wizard_pass' %}
                        <div class="dialogue-box angry">
                            <span class="typewriter">
                                "Sneaking through ancient woods is rarely wise."
                            </span>
                        </div>
                    {% endif %}          
            </div>
        {% endif %}

        <form action="{{ url_for('game') }}" method="post" class="choices">
            {% for value, label in options %}
                <button type="submit" name="choice" value="{{ value }}" class="action-btn">
                    {{ label }}
                </button>
            {% endfor %}
        </form>
    </div>

    <audio id="typeSound" preload="auto" src="{{ url_for('static', filename='sounds/type.wav') }}"></audio>
    
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const elements = document.querySelectorAll(".typewriter");
            const typeSound = document.getElementById("typeSound");

            if (typeSound) {
                typeSound.volume = 0;
                typeSound.play().then(() => {
                    typeSound.pause();
                    typeSound.currentTime = 0;
                    typeSound.volume = 0.25;
                }).catch(() => {});
            }

            elements.forEach(el => {
                const text = el.textContent;
                el.textContent = "";
                let i = 0;
                let typing = true;

                function type() {
                    if (i < text.length && typing) {
                        el.textContent += text.charAt(i);
                        i++;
                        setTimeout(type, 40);
                    }
                }

                el.addEventListener("click", () => {
                    typing = false;
                    el.textContent = text;
                });

                type();
            });

            const sparkleContainer = document.querySelector(".sparkles");
            if (sparkleContainer) {
                setInterval(() => {
                    const sparkle = document.createElement("span");
                    sparkle.style.left = Math.random() * 100 + "%";
                    sparkle.style.top = Math.random() * 100 + "%";
                    sparkle.style.animationDuration = 2 + Math.random() * 2 + "s";
                    sparkleContainer.appendChild(sparkle);
                    setTimeout(() => sparkle.remove(), 4000);
                }, 300);
            }

            const wizardSparkles = document.querySelector(".wizard-sparkles");
            if (wizardSparkles) {
                setInterval(() => {
                    const sparkle = document.createElement("span");
                    sparkle.style.left = Math.random() * 100 + "%";
                    sparkle.style.top = Math.random() * 100 + "%";
                    wizardSparkles.appendChild(sparkle);
                    setTimeout(() => sparkle.remove(), 4000);
                }, 500);
            }
        });

    </script>

</body>
</html>
